version: 2

models:
  - name: dbt_invocations
    description: >
      Attributes associated with each dbt invocation. Inserted at the end of each invocation.

    columns:
      - name: invocation_id
        data_type: string
        tests:
          - not_null
          - unique
          - relationships:
              field: invocation_id
              to: ref('dbt_run_results')

      - name: run_started_at
        data_type:
        description:

      - name: run_completed_at
        data_type:
        description:

      - name: generated_at
        data_type:
        description:

      - name: command
        data_type:
        description:

      - name: dbt_version
        data_type:
        description:

      - name: elementary_version
        data_type:
        description:

      - name: full_refresh
        data_type: boolean
        description: Whether or not this invocation was executed with a full-refresh flag

      - name: cli_vars
        data_type:
        description:

      - name: vars
        data_type:
        description:

      - name: target_name
        data_type:
        description:

      - name: target_database
        data_type: string
        description: Name of the target schema that was used in this invocation.

      - name: target_schema
        data_type: string
        description: Name of the target schema that was used in this invocation.

      - name: target_profile_name
        data_type: string
        description: Name of the dbt profile that was used in this invocation.

      - name: threads
        data_type: integer
        description: ""

      - name: selected
        data_type: string
        description: While this is a string in the database, this can easily be converted to an array.

      - name: yaml_selector
        data_type: string
        description: The yaml selector that was passed in this invocation.


  - name: dbt_run_results
    description: >
      Run results of dbt invocations, inserted at the end of each invocation.
      Each row is the invocation result of a single resource (model, test, snapshot, etc).
      New data is loaded to this model on an on-run-end hook named 'elementary.upload_run_results' from each invocation that produces a result object.
      This is an incremental model.
    columns:
      - name: model_execution_id
        data_type: string
        description: Execution id generated by joining the unique_id of the resource and the invocation_id. This is the unique key of each row in this model.

      - name: unique_id
        data_type: string
        description: The unique id of the resource (would be similar for all executions of the same resource).

      - name: invocation_id
        data_type: string
        description: The unique id of the invocation (would be similar for all resources executed on the same invocation).

      - name: generated_at
        data_type: string
        description: ""

      - name: name
        data_type: string
        description: Resource name.

      - name: message
        data_type: string
        description: Execution results message returned by dbt.

      - name: status
        data_type: string
        description: Execution result status (success, error, pass, fail)

      - name: resource_type
        data_type: string
        description: Resource type (model, test, snapshot, seed, etc)

      - name: execution_time
        data_type: float
        description: Resource execution duration in seconds.

      - name: execute_started_at
        data_type: string
        description: Start time of the execution.

      - name: execute_completed_at
        data_type: string
        description: End time of the execution.

      - name: compile_started_at
        data_type: string
        description: Start time of resource compile action.

      - name: compile_completed_at
        data_type: string
        description: End time of resource compile action.

      - name: rows_affected
        data_type: int
        description: ""

      - name: full_refresh
        data_type: boolean
        description: Was this a full refresh execution.

      - name: compiled_code
        data_type: string
        description: The compiled code (SQL / Python) executed against the database.

  - name: elementary_test_results
    description: >
      Run results of all dbt tests, with fields and metadata needed to produce the Elementary report UI.
      Each row is the result of a single test, including native dbt tests, packages tests and elementary tests.
      New data is loaded to this model on an on-run-end hook named `elementary.handle_tests_results`.

  - name: model_run_results
    description: >
      Run results of dbt models, enriched with models metadata.
      Each row is the result of a single model.
      This is a view that joins data from `dbt_run_results` and `dbt_models`.

  - name: snapshot_run_results
    description: >
      Run results of dbt snapshots, enriched with snapshots metadata.
      Each row is the result of a single snapshot.
      This is a view that joins data from `dbt_run_results` and `dbt_snapshots`.

